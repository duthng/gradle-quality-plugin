language: java
install: true

addons:
  sonarcloud:
    organization: "ekino-1"

jdk:
- openjdk11

env:
  global:
  - GPG_FILE_NAME="ekino-gradle-quality-plugin.gpg"
  - ENCRYPTED_GPG_FILE_NAME="ekino-gradle-quality-plugin.gpg.enc"
  - PUBLISH_SNAPSHOT_REPO_URL="https://oss.sonatype.org/content/repositories/snapshots/"
  - PUBLISH_RELEASE_REPO_URL="https://oss.sonatype.org/service/local/staging/deploy/maven2/"
  - secure: j18O8rQrBies2VkQnDAPqgf74MvIm6X46OFfBCZB22YzWgy4hsNNAeixK/pvBTnsVoy8Ck8gMhZwbZgFAhI4pDT5/LxZ/I2cpjD49vGd1JeyjxeanLGeSMRli0hGOj9Cia6CnA9dutjKgifu3bLdjcnKpSU+1n034pWTzZgNhoFX4Z3GyDuib5KZk0djejHtu7hiiDO76XVbib/YoKgzNDuvBS+B6DQ9DkY41eEGbWkYM0dYsggBGezryRyTLIsIAElzeKYW52qQKRST30eRO7wYaxlz0Qm27skCBHd910+rzAQytyO4T1k1Y0h2yABwqHiVw7RWYG3cXA8myboY3lvEcOEC+xIdwvSkuKDmEVWcu9EMwTXqHBtRmNxmMNl4T5GcBhlGU8OmKBhVkRPt44OS3yTBNgksN1DvQlAaCcJxKA4vmOi3qQ3rjl/NOyIZyQacqKx4e0CRqosQ8GQ6Bv870SC5vI8k7dZ41Y0hT2MxeP4Uv5usgNNqTopiSyw9Jj2iAmjnQSC+03DTdf4ObWmxInZjElSpgiKldL1cLGRNf8Cjt1egZsdQ8DI1RsY4Y++8AjlTdoPyHXcUuNyRTTC0amo6XZgXcH5eKUVyqsE0M1F5E8soR3m/U6nPxk1aU4HRfswMPkLyFUMvcXcDIKcuZkppTjVS4ls1rV6qu3I=
  - secure: mFttga1I41WWfdYT+qE0/Sf7QkwcrQ7LAIerUJgKOrPjBRMkGzK4hlQDoIM38vC5BK2ySlC+bJRahsAkbPPd+3457V0KawYS6JFsz+iWbll8Tmnoukqg6LDIn8Kser3/++SbcvrbSLnMz7mQMus7Smw7E9O0xSc8nIP4s0ffprqfhV6U2NlvV347X9/HscSXh1Rn071Da3hpMbY6rzbqxyK54YLl5gecXhTcCNP3CSDvdLnb7Y1W/uCOGbowgkVZGD2Hhq+OLf7I6Q5tdTxlm8QNFIoRhhS8NEO5EurgQHmKKLCquNT8UaUHzDwyE+iodVxSH10JQzofm8yhJW+LxtWMimFD7XTotUBiLB0S1jlesZS+wKYBFwQCDE5nXbjqMLucyMELWhnInlOwaZfsz8q83f8B4vCX0KLERDnKvIJgfXau2MjaI2y+/p9InMMUJqpKNhROeU3vzRAjGmGwNpn8w4E1b9z2zPlKWWApEIE61WOhlwS7A9cKp8xNFigqtnNPz2GU0rvCtjaaju/jN3pQz/BNrTksPN4pmHA8L4r74RmUBDJe7LVlBoA0uHWGZoK3Af+SbaOTNu7vcwnaOKu5lfMmXVgx2/mxLiX5gaMd9iNiraiyWcK4HxNm4OIz0NPxdcrwYYg8XYqUb6v4b/PkfT4w90j5aejQjicELeU=
  - secure: FHZNyKY8h3htEZcCv8T/Y7yxPcK+VWTDJsWK3xBl/oxCQRdKXkY6LvZjYTdHfFPg0gFG3QbgIWy9/LsEBFyh6SEsOfk7JGVEuQRDJ8EmUIQcFATHoeJ2WmvzW8Q+v4NR8AneFgGcx52wO9wYxAZ1asnsoDya6/zz+2bCZhM9lw0eWFp2k18EztCW1njLoO3jqOCxLhGhwHz6KchKmG7435pn34JSl+NbDrsIn99iqQQhTqD4ucFtsMV4Trz+G8cryiHkiS3ytHIgfaeuulItt9zuBDqH7M3puoRpCvYuYYZ0L/DidpvKsodzFxgyFaLVsmrNhWcp+kkY4gzBtaFLyiyUdlUyAaxr93qBbHvkfJ5ffCwXa9iyaceIx7WL0DtBukjeh/ihrtXx/z6ggJSxeCb8h0IuP2Sq/E7t+FWe4xDbFkTSQ632b3OjpPa+9+lZ2Yq7ByjS8fxIz8MjA8VFrwd5Op0dACc7rw//MLILZdR1qqBc8e3rWnCkAWSfuQXaji19x2X6CwV00sY4dBSLFHg6PAzuaOKoJaSeLc19FOw2zeicCF3VpgAhTsB4HJWJYQMO021/eogDBh1VMHsuU0K8p8SdcLI8P7/rZxBfvu/M7TPy7MKcZs8n/yVivmfy3Nt4vc/KtLVgMhcD9nwNzGtd0gbMnA2ja4pqI8xshmI=
  - secure: UTIUFaOBBRASGX/hK73VcTJvflQVc0AzgnxVMy4TZ5L02J/x1KszTL4tAe+4QE1PTIOaEQ8sp3eOwlQMl8lIzlOq1Z5y4o2m0r375q2qTRmGtjf5CAHahibV6wLYH0Mjgmk5WMgkBf9U5GS6O7fkiXADGnkDI9GvqMXUHjvw4O4pX3gTLDpJTyo7V0/36spZ64xzGcm3zSVjWuC1l7d8lGWqdCEKEvJ7As1jluaYYlMKUh7kOq4TEG4bQaUY6SCp8b1LqybYSJ/dOD03LfHf4bDiIuJs8X7tppZIBogWR0dTQfmO19J+VXjdoUAhwK1wTHOXhBVGSSOtQLaynkyzaDRhjrWUqzv6R5LPXuQx5mqLsQah0r3qHug9kl2m9TRtl/TGJgkE1KSqRVxcXqIw95Ot1BuaBZnw3bBkxlUxGo7Xt3sEFMVUlpFFYLwzVgjaDGjSgIyeWCbAAmdlEFxnUgPlVhFDO+bY5viSl9sT4zefAxMg1BGCkgy/7kvwo5EmQGjMOLcziKA2NE5YR13hapEngUfIfpa1dMwCk87K7UpanbHgbuX3hSSWSIh1pC4wbMoBybRR9HsAmUY44nR6zMug5ZOOfKLTzRP9N5BhshmMbWiW2ve7Mgqm81H0PSmDzNL7jkwBxF/8serVi94hrEk08zZUuxGjPpyJ3PkNMqE=
  - secure: Nw23a1/3lEMpUtCgLzbl7NqM9fqQtrTgW/VDcoMZKQLAttt5dRK+ew7kyEAtrQsSeSxR9UJUwqsP24ZRrjZ4fkF1rI6WprDJxfKvP9zjJANkC12B4gRHH6qhViML+nLhTx0gj+XtLNOJMWXcTTTF1yjE/sc7N7uH9ga+wmaypuYuVlBwiWUN0H7Db48s1NZwLNitlDV3tRSd161RgGlcWn0uLuxoHLmcV+DuH7I2mRz4imRa3BI5p8ap++ddY90M321VwiNNTXW1jM9s3sZ11J6201jVYkSqYDu3bROuIitTcSKSb6Oj/dyLdby/QaLJmiUXITA5KcQf0CmNVKFYBVMk6L/oyo/SYf8qSaT/TTwufCT8I+u0FmwLlZ2xvDDWuP/oO1YakZMc6dqvApzlDuAcoxVIsjJaVERRW8IrQdw7ZtZAHFxAzYigP4sM49XKDdF5UOxW9yotcwZWy9WU6A3DnmsIHcZO0IIowiRmR5MvMxgQwm16IRcZ36IRMYg2NrjkSjT1WRefxkMzvrkxglN5SNeTAj0n3XHlWcvCSox6V/YyAlQ1MGOcjjtI+iIcu9LiGK3pIRlDYVHoF4v3US1ibQtvtVm5qUptFSRy3f0PqvaX+37+2xn8jsk6LttaR54qaU7kFHIqtfAtiOa8PgSQK1YKkVIBuFlNqBkHHBQ=

before_script:
- chmod -R ug+x .travis

jobs:
  include:
  - stage: test
    name: Build
    script: ".travis/build.sh"
  - stage: deploy
    name: Deploy Snapshot
    if: |
      branch = master AND \
      type = push
    script: ".travis/deploy.sh"
  - stage: deploy
    name: Deploy Release
    if: tag IS present AND tag =~ ^(\d)+\.(\d)+(\.(\d)+)*(-[\w]+)*$
    script: ".travis/deploy.sh"
    deploy:
      provider: releases
      api_key:
        secure: aag6gTu6cDyfSdJosUoCevPnW2FLTT9ydp8OPvj8LaS0Wk+9N+jlnQgY98H3Feg6aAFzitg1LJPX+tBH1hQLMM7wqF+eN7NPvCr6Gg7UfYPWRrFu7SWzkpTcfYjIeUa1AJcJ3io1tf+uFC5Pc2JoTNPE61lahyGxFx/esIarizm4aQxH4dE0M47N9SydcULRclt1N/GjxY0Cv3Yr2955xLEv0YG1VKUvkHKLmv20dOz3R+uBpMmlo+Wf9vt1q54ffivAi5q353Us5veHes4A//Cj1DWN68iN1vRKk/2tDLV4A+UnKinBUCdaoU3ivZyx2nupZRqXtNkTCNEbc4EY8wja86fxuOGsp7Z3MOVBed/no5YQ2jAxOeqqHpXE9pBZyIypmtBFTyTCGTfY8kcICqlAcrlilv0ZD8MJ5/NxyqcJggSGRnUxAwRcyNpFB38fKTXdPYaKlab8RAg6RgbeqC5dqbs3DOikeAlcQwblMhXm5z9sA32sgph8ZG4O6xZpIYT16Zyb+rPFz3LCLwMtsWic15DE9Vo+w6xgYwHmmuh+gdSr39q2Q5r4AIC6Du7zTJERBBjHyS85B7ejpGZ3+BC9dTHZrwoLeYx++gjmIBOdhvXVmJPjuI99WpzerBu0u56chWzfrHlIpZZWOt+VFttrGuiWjI2g3him9DQ864Q=
      file_glob: true
      file: "$TRAVIS_BUILD_DIR/build/libs/*"
      body: Release of $TRAVIS_TAG
      skip_cleanup: true
      draft: true
      on:
        repo: ekino/gradle-quality-plugin
        tags: true

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"